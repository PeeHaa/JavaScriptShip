var ExtendedMath=Object.create(Math);ExtendedMath.rand=function(b,a){return Math.floor(Math.random()*(a-b+1))+b};function RandomItemGenerator(){this.getRandomItem=function(b){var a=this.generateRandomPool(b);return a[ExtendedMath.rand(0,a.length)]};this.generateRandomPool=function(d){var c=[];for(var b in d){if(!d.hasOwnProperty(b)){continue}for(var a=0;a<d[b];a++){c.push(b)}}return c}}function GameEngine(b){var a=b.getContext("2d");this.map={};this.currentGame={sector:1,turns:0,view:"map"};this.newGame=function(){this.map=new Map(b,a).generate(this.currentGame.sector)};b.addEventListener("mouseover",function(c){this.hoverAction(c)}.bind(this));b.addEventListener("mousemove",function(c){this.hoverAction(c)}.bind(this));this.hoverAction=function(c){if(this.currentGame.view==="map"){this.map.showPositionInfo(c)}};b.addEventListener("click",function(c){if(this.currentGame.view==="map"){if(this.map.isActiveJumpValid()){this.map.moveToActiveJump();this.turns++}}}.bind(this))}function Map(b,a){this.sector=1;this.position=null;this.jumps=[];this.exitJumpDrawOffset=0;this.settings={width:b.width,height:b.height,minJumps:20,maxJumps:30};this.generate=function(c){this.sector=c;this.generateJumps();this.setStartingPosition();this.setExitPosition();this.draw();this.exitSpinner();return this};this.draw=function(){this.addBackground();this.addHeader();this.addPaths();this.addJumps()};this.setStartingPosition=function(){var e=null,h=[];for(var f=0,d=this.jumps.length;f<d;f++){var c=this.jumps[f];if(e===null||c.info.x<e.info.x){e=c}if(c.info.x<=Map.STARTING_POINT_RANGE){h.push(c)}if(h.length===3){break}}if(h.length>0){var g=h[ExtendedMath.rand(0,(h.length-1))]}else{var g=e}g.info.environment=[];g.info.events=[];g.info.ships=[];g.info.hasPlayer=true;this.position=g};this.setExitPosition=function(){var f=null,h=[];for(var g=0,d=this.jumps.length;g<d;g++){var c=this.jumps[g];if(f===null||c.info.x>f.info.x){f=c}if(c.info.x>=(this.settings.width-Map.EXIT_POINT_RANGE)){h.push(c)}if(h.length===3){break}}if(h.length>0){var e=h[ExtendedMath.rand(0,(h.length-1))]}else{var e=f}e.info.isExit=true};this.addBackground=function(){var c=a.createLinearGradient(0,0,0,150);c.addColorStop(0,"#203060");c.addColorStop(1,"#0F153C");a.fillStyle=c;a.fillRect(0,0,this.settings.width,this.settings.height)};this.addHeader=function(c){a.fillStyle="#ffffff";a.font="bold 16px Verdana";a.fillText("Sector "+this.sector,10,25)};this.generateJumps=function(){var c=ExtendedMath.rand(this.settings.minJumps,this.settings.maxJumps);for(var d=0;d<c;d++){this.addRandomJump()}};this.addRandomJump=function(){var c=ExtendedMath.rand(Map.MINIMUM_DISTANCE_TO_BORDERS,(this.settings.width-Map.MINIMUM_DISTANCE_TO_BORDERS)),d=ExtendedMath.rand(Map.MINIMUM_DISTANCE_TO_BORDERS,(this.settings.height-Map.MINIMUM_DISTANCE_TO_BORDERS));this.jumps.push(new Jump(c,d))};this.isValidJump=function(c,g){for(var f=0,d=this.jumps.length;f<d;f++){var e=this.jumps[f].info;if(c>(e.x-Map.MINIMUM_DISTANCE_BETWEEN_JUMPS)&&c<(e.x+Map.MINIMUM_DISTANCE_BETWEEN_JUMPS)){return false}if(g>(e.y-Map.MINIMUM_DISTANCE_BETWEEN_JUMPS)&&g<(e.y+Map.MINIMUM_DISTANCE_BETWEEN_JUMPS)){return false}}return true};this.addPaths=function(){this.jumps.forEach(function(c){if(c.info.isActive){this.showPaths(c)}}.bind(this))};this.addJumps=function(){this.jumps.forEach(function(c){this.addJump(c)}.bind(this))};this.addJump=function(c){a.beginPath();a.arc(c.info.x,c.info.y,5,0,2*Math.PI,false);a.fillStyle=c.info.visited?"#e3e3e3":"#ffffff";a.fillStyle=c.info.hasPlayer?"#000000":a.fillStyle;a.fill();a.lineWidth=2;a.strokeStyle=c.info.isActive?"#ffd1e4":"#00d1e4";a.strokeStyle=c.info.visited?"#3e3e3e":a.strokeStyle;if(c.info.isExit){a.setLineDash([3,2]);a.lineDashOffset=this.exitJumpDrawOffset}a.stroke();a.setLineDash([])};this.showPositionInfo=function(c){this.jumps.forEach(function(d){if(d.isInRange(c.x,c.y)){d.info.isActive=true}else{d.info.isActive=false}});this.draw()};this.showPaths=function(c){this.jumps.forEach(function(d){if(d.isInRangeForPath(c.info.x,c.info.y)){this.addPath(c,d)}}.bind(this))};this.addPath=function(d,c){a.beginPath();a.lineWidth=1;a.setLineDash([10,2]);a.strokeStyle="#22ff66";a.moveTo(d.info.x,d.info.y);a.lineTo(c.info.x,c.info.y);a.stroke();a.setLineDash([])};this.isActiveJumpValid=function(){for(var d=0,c=this.jumps.length;d<c;d++){if(!this.jumps[d].info.isActive){continue}return this.position.isInRangeForPath(this.jumps[d].info.x,this.jumps[d].info.y)}return false};this.moveToActiveJump=function(){for(var e=0,d=this.jumps.length;e<d;e++){var c=this.jumps[e];if(c.info.hasPlayer){c.info.visited=true}c.info.hasPlayer=false;if(this.jumps[e].info.isActive){c.info.hasPlayer=true;this.position=c}}this.draw()};this.exitSpinner=function(){setTimeout(function(){this.exitJumpDrawOffset++;this.draw();this.exitSpinner()}.bind(this),50)}}Map.MINIMUM_DISTANCE_BETWEEN_JUMPS=30;Map.MINIMUM_DISTANCE_TO_BORDERS=15;Map.STARTING_POINT_RANGE=100;Map.EXIT_POINT_RANGE=100;function Jump(a,b){this.info={x:a,y:b,environment:[],events:[],ships:[],hasPlayer:false,isActive:false,visited:false,isExit:false};this.randomItemGenerator=new RandomItemGenerator();this.initialize=function(){this.setRandomEnvironment();this.setRandomEvent()};this.setRandomEnvironment=function(){this.info.environment.push(this.randomItemGenerator.getRandomItem({normal:15,solar:2,astroid:2}))};this.setRandomEvent=function(){this.info.events.push(this.randomItemGenerator.getRandomItem({none:15}))};this.isInRange=function(c,d){if(c>this.info.x&&c<(this.info.x+15)&&d>this.info.y&&d<(this.info.y+15)){return true}return false};this.isInRangeForPath=function(c,d){if(c>(this.info.x-Jump.MAXIMUM_DISTANCE_FOR_PATH)&&c<(this.info.x+Jump.MAXIMUM_DISTANCE_FOR_PATH)&&d>(this.info.y-Jump.MAXIMUM_DISTANCE_FOR_PATH)&&d<(this.info.y+Jump.MAXIMUM_DISTANCE_FOR_PATH)){return true}return false};this.initialize()}Jump.MAXIMUM_DISTANCE_FOR_PATH=150;